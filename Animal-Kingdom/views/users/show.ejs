<%- include('../partials/header') %>

<h1>Welcome back, <span class="user-name"><%= user.firstName %></span></h1>

<!-- Owner -->
<% if(user.userType==="Owner" ){ %>
  <!-- Pets Overview -->
  <section class="pet-overview">
    <h2>Your Pets</h2>
    <% if(pets.length){ %>
      <% pets.forEach(p=> { %>
        <div class="card pet-card">
          <div>
            <img class='pet-img' src="/images/pet.jpg" alt="Pet">
            <div class="pet-info">
              <h4>
                <%= p.name %>
              </h4>
              <p>
                <%= p.species %>, <%= p.breed %>
              </p>
              <p>
                <%= p.age %> Years old
              </p>
              <p>
                DOB: <%= p.DOB.toLocaleDateString() %>
              </p>
            </div>
            <a class='card-btn' href="/user/<%= user._id %>/pets/<%= p._id %>">Medical Records</a>
          </div>
          <form action="/user/<%= user._id %>/pets/<%= p._id %>?_method=DELETE" method="POST">
            <button class="card-delete" type="submit"><img src="/images/close.svg" alt="X"></button>
          </form>
          <a class='card-edit' href="/user/<%= user._id %>/pets/<%= p._id %>/edit">Edit</a>
        </div>
        <% }) %>
          <% } else { %>
            <% } %>
              <div class="card add-pet">
                <a href="/user/<%= user._id %>/pets/new">Add a Pet</a>
              </div>
  </section>

  <!-- Appointments Overview -->
  <section class="apointments">
    <h3>Upcoming Appointments</h3>
    <% petAppointments.forEach(pa => { %>
      <form action="/user/<%= user._id %>/appointments/<%= pa._id %>/cancel?_method=PUT" method="POST">
      <p><%= pa.pet.name %>'s Appointment:</p>
      <p><%= pa.date.toLocaleDateString() %></p>
      <p><%= pa.date.toLocaleTimeString()%></p>
      <p>Vet: Dr. <%= pa.vet.firstName %> <%= pa.vet.lastName %></p>
      <button type="submit">CANCEL</button>
    </form>
    <% }) %>
  </section>

  <% } %>

  
  <% if(user.userType==="Veterinarian" ) { %>
    <section class="pet-overview"> 
    
    <div>
      <% if(patients.length){ %>
        <% patients.forEach(p=> { %>
          <div class="card pet-card">
          <div>
            <img class='pet-img' src="/images/pet.jpg" alt="Pet">
            <div class="pet-info">
            <h4>
              <%= p._doc.name %>
            </h4>
            <p>Species: <%= p._doc.species %>
            </p>
            <p>Breed: <%= p._doc.breed %>
            </p>
            <p>Age: <%= p._doc.age %>
            </p>
            <p>DOB: <%= p._doc.DOB.toLocaleDateString() %>
            </p>
          </div>
            <br />
            <a class='card-btn' href="/user/<%= user._id %>/pets/<%= p._doc._id %>">Medical Records</a>
          </div>
        </div>
          <% }) %>
            <% } else{ %>
              <div class="card pet-card">
                <div class="pet-info">
              <p>No Patients Yet. <a href="/user/<%= user._id %>/records/new">Create Medical Record</a></p>
              </p>
            </div>
            </div>
  
              <% } %>
                
    </div>
  </section>

   <!-- Appointments Overview -->
   <section class="apointments">
    <h3>Upcoming Appointments</h3>
    <% if(vetAppointments.length) { %>
    <% vetAppointments.forEach(va => { %>
      <form action="/user/<%= user._id %>/appointments/<%= va._id %>/cancel?_method=PUT" method="POST">
      <p><%= va.pet.name %>'s Appointment:</p>
      <p><%= va.date.toLocaleDateString() %></p>
      <p><%= va.date.toLocaleTimeString()%></p>
      
      <button type="submit">CANCEL</button>
    </form>
    <% }) %>
    <% } else{%>
      <p>No Appointments Yet.</p>
      <% } %>
    
  </section>
  <% } %>

<%- include('../partials/footer') %>
